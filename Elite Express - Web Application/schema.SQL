create database GroseryStore;
use GroseryStore;

DROP TABLE IF EXISTS `Admin`;
DROP TABLE IF EXISTS `OrderDetails`;
DROP TABLE IF EXISTS `Orders`;
DROP TABLE IF EXISTS `CART`;
DROP TABLE IF EXISTS `Customer`;
DROP TABLE IF EXISTS `ProductItemCategories`;
DROP TABLE IF EXISTS `ProductCategories`;
DROP TABLE IF EXISTS `ProductItem`;


CREATE TABLE IF NOT EXISTS `Admin`(
`AdminID` INT PRIMARY KEY AUTO_INCREMENT,
`Name` VARCHAR(30) NOT NULL,
`Email` VARCHAR(30) NOT NULL,
`Password` VARCHAR(30) NOT NULL
);

CREATE TABLE IF NOT EXISTS `Customer`(
`CusID` INT PRIMARY KEY AUTO_INCREMENT,
`Name` VARCHAR(30) NOT NULL,
`Email` VARCHAR(30) NOT NULL,
`Password` VARCHAR(30) NOT NULL,
`Address` VARCHAR(100) NOT NULL,
`City` VARCHAR(20) NOT NULL,
`ZipCode` INT NOT NULL,
`Country` VARCHAR(30) NOT NULL
);

CREATE TABLE IF NOT EXISTS `ProductCategories`(
`ID` INT PRIMARY KEY AUTO_INCREMENT,
`CategoriesName` VARCHAR(30) NOT NULL UNIQUE,
`Parent` INT NOT NULL
);

CREATE TABLE IF NOT EXISTS `ProductItem`(   -- sub categories
`ItemID` INT PRIMARY KEY AUTO_INCREMENT,
`Name` VARCHAR(30) NOT NULL,
`Quantity` INT NOT NULL,
`Price` INT NOT NULL,
`Amount` VARCHAR(6) NOT NULL, 
`Picture` VARCHAR(1000) NOT NULL,
`Description` VARCHAR(200),
CONSTRAINT prc_chk CHECK(Price > 0),
CONSTRAINT unq_name_amount UNIQUE (Name, Amount)
);

CREATE TABLE IF NOT EXISTS `ProductItemCategories`(
`ProductID` INT NOT NULL,
`CategoryID` INT NOT NULL,
CONSTRAINT fk_proid FOREIGN KEY(ProductID) REFERENCES ProductItem(ItemID) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT fk_catid FOREIGN KEY(CategoryID) REFERENCES ProductCategories(ID) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS `CART`(
`CustID` int NOT NULL,
`ItemID` INT NOT NULL,
`Quantity` INT NOT NULL,
CONSTRAINT fk_custid FOREIGN KEY(CustID) REFERENCES Customer(CusID) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT fk_itemid FOREIGN KEY(ItemID) REFERENCES ProductItem(ItemID) ON UPDATE CASCADE ON DELETE CASCADE,
PRIMARY KEY(CustID, ItemID)
);

CREATE TABLE IF NOT EXISTS `Orders`(
`Order_ID` INT PRIMARY KEY AUTO_INCREMENT,
`OrderTime` DATETIME,
`TrackingID` VARCHAR(20) NOT NULL UNIQUE,
`CustID` int NOT NULL,
`TotalPrice` int NOT NULL,
`Status` VARCHAR(20) NOT NULL,
CONSTRAINT fk_cusid FOREIGN KEY(CustID) REFERENCES Customer(CusID) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS `OrderDetails`(
`OrderID` INT NOT NULL,
`ItemsID` INT NOT NULL,
`Quantity` INT NOT NULL,
`ItemPrice` INT NOT NULL,
CONSTRAINT Quantity_chk CHECK(Quantity > 0),
CONSTRAINT fk_itemsid FOREIGN KEY(ItemsID) REFERENCES ProductItem(ItemID) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT fk_orderid FOREIGN KEY(OrderID) REFERENCES Orders(Order_ID) ON UPDATE CASCADE ON DELETE CASCADE,
PRIMARY KEY(OrderID, ItemsID)
);